<?php
/**
 * Iban
 *
 * @author      Stefan Warnat
 * @link        https://github.com/jschaedl/Iban
 *
 * MIT LICENSE
 */
namespace IBAN\Rule\DE;

class Rule000503 extends \IBAN\Rule\DE\Rule000000
{
    public function __construct($localeCode, $instituteIdentification, $bankAccountNumber)
    {
        $bankAccountReplacement = array(
            "30040000#36" => "2611036",
            "47880031#50" => "519899900",
            "47840065#50" => "1501030",
            "47840065#55" => "1501030",
            "70080000#94" => "928553201",
            "70040041#94" => "2128080",
            "47840065#99" => "1501030",
            "37080040#100" => "269100000",
            "38040007#100" => "119160000",
            "37080040#111" => "215022000",
            "51080060#123" => "12299300",
            "36040039#150" => "1616200",
            "68080030#202" => "416520200",
            "30040000#222" => "348010002",
            "38040007#240" => "1090240",
            "69240075#444" => "4455200",
            "60080000#502" => "901581400",
            "60040071#502" => "5259502",
            "55040022#555" => "211050000",
            "39080005#556" => "204655600",
            "39040013#556" => "1065556",
            "57080070#661" => "604101200",
            "26580070#700" => "710000000",
            "50640015#777" => "2222222",
            "30040000#999" => "1237999",
            "86080000#1212" => "480375900",
            "37040044#1888" => "212129101",
            "25040066#1919" => "1419191",
            "10080000#1987" => "928127700",
            "50040000#2000" => "7284003",
            "20080000#2222" => "903927200",
            "38040007#3366" => "3853330",
            "37080040#4004" => "233533500",
            "37080040#4444" => "233000300",
            "43080083#4630" => "825110100",
            "50080000#6060" => "96736100",
            "10040000#7878" => "2678787",
            "10080000#8888" => "928126501",
            "50080000#9000" => "26492100",
            "79080052#9696" => "300021700",
            "79040047#9696" => "6802102",
            "39080005#9800" => "208457000",
            "50080000#42195" => "900333200",
            "32040024#47800" => "1555150",
            "37080040#55555" => "263602501",
            "38040007#55555" => "3055555",
            "50080000#101010" => "90003500",
            "50040000#101010" => "3110111",
            "37040044#102030" => "2223444",
            "86080000#121200" => "480375900",
            "66280053#121212" => "625242400",
            "16080000#123456" => "12345600",
            "29080010#124124" => "107502000",
            "37080040#182002" => "216603302",
            "12080000#212121" => "4050462200",
            "37080040#300000" => "983307900",
            "37040044#300000" => "3000007",
            "37080040#333333" => "270330000",
            "38040007#336666" => "1052323",
            "55040022#343434" => "217900000",
            "85080000#400000" => "459488501",
            "37080040#414141" => "41414100",
            "38040007#414141" => "1080001",
            "20080000#505050" => "500100600",
            "37080040#555666" => "55566600",
            "20080000#666666" => "900732500",
            "30080000#700000" => "800005000",
            "70080000#700000" => "750055500",
            "70080000#900000" => "319966601",
            "37080040#909090" => "269100000",
            "38040007#909090" => "119160000",
            "70080000#949494" => "575757500",
            "70080000#1111111" => "448060000",
            "70040041#1111111" => "1521400",
            "10080000#1234567" => "920192001",
            "38040007#1555555" => "2582666",
            "76040061#2500000" => "4821468",
            "16080000#3030400" => "4205227110",
            "37080040#5555500" => "263602501",
            "75040062#6008833" => "600883300",
            "12080000#7654321" => "144000700",
            "70080000#7777777" => "443540000",
            "70040041#7777777" => "2136000",
            "64140036#8907339" => "890733900",
            "70080000#9000000" => "319966601",
            "61080006#9999999" => "202427500",
            "12080000#12121212" => "4101725100",
            "29080010#12412400" => "107502000",
            "34280032#14111935" => "645753800",
            "38040007#43434343" => "1181635",
            "30080000#70000000" => "800005000",
            "70080000#70000000" => "750055500",
            "44040037#111111111" => "3205655",
            "70040041#400500500" => "4005005",
            "60080000#500500500" => "901581400",
            "60040071#500500500" => "5127006"
        );

        if (isset($instituteIdentificationReplacement[$instituteIdentification . "#" . $bankAccountNumber])) {
            $bankAccountNumber = $instituteIdentificationReplacement[$instituteIdentification . "#" . $bankAccountNumber];
        }

        parent::__construct($localeCode, $instituteIdentification, $bankAccountNumber);
    }
    public function generateIban()
    {
        $partialBlockedInstituteIdentifications = array(
            "10080900",
            "25780022",
            "42080082",
            "53080030",
            "64380011",
            "79080052",
            "12080000",
            "25980027",
            "42680081",
            "54080021",
            "65080009",
            "79380051",
            "13080000",
            "26080024",
            "43080083",
            "54280023",
            "65180005",
            "79580099",
            "14080000",
            "26281420",
            "44080055",
            "54580020",
            "65380003",
            "80080000",
            "15080000",
            "26580070",
            "44080057",
            "54680022",
            "66280053",
            "81080000",
            "16080000",
            "26880063",
            "44580070",
            "55080065",
            "66680013",
            "82080000",
            "17080000",
            "26981062",
            "45080060",
            "57080070",
            "67280051",
            "83080000",
            "18080000",
            "28280012",
            "46080010",
            "58580074",
            "69280035",
            "84080000",
            "20080055",
            "29280011",
            "47880031",
            "59080090",
            "70080056",
            "85080200",
            "20080057",
            "30080055",
            "49080025",
            "60080055",
            "70080057",
            "86080055",
            "21080050",
            "30080057",
            "50080055",
            "60080057",
            "70380006",
            "86080057",
            "21280002",
            "31080015",
            "50080057",
            "60380002",
            "71180005",
            "87080000",
            "21480003",
            "32080010",
            "50080081",
            "60480008",
            "72180002",
            "21580000",
            "33080030",
            "50080082",
            "61080006",
            "73180011",
            "22180000",
            "34080031",
            "50680002",
            "61281007",
            "73380004",
            "22181400",
            "34280032",
            "50780006",
            "61480001",
            "73480013",
            "22280000",
            "36280071",
            "50880050",
            "62080012",
            "74180009",
            "24080000",
            "36580072",
            "51080000",
            "62280012",
            "74380007",
            "24180001",
            "40080040",
            "51380040",
            "63080015",
            "75080003",
            "25480021",
            "41280043",
            "52080080",
            "64080014",
            "76080053"
        );

        if (in_array($this->instituteIdentification, $partialBlockedInstituteIdentifications) &&
            intval($this->bankAccountNumber) >= 998000000 &&
            intval($this->bankAccountNumber) <= 999499999) {
            return "";
        }

        $completeBlockedInstituteIdentifications = array(
            "10045050",
            "50040033",
            "70045050", // Gesperrte BLZ
            "10040085",
            "35040085",
            "36040085",
            "44040085",
            "50040085",
            "67040085",
            "82040085"  # Sperrung beantragt in Juni 2013 Dokument
        );

        if (in_array($this->instituteIdentification, $completeBlockedInstituteIdentifications)) {
            return "";
        }

        return parent::generateIban();
    }
}
